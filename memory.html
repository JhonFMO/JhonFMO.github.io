<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Añadido para responsividad -->
    <title>Memorama</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        :root {
            --w: calc(70vw / 6);
            --h: calc(70vh / 4);
        }

        * {
            transition: all 0.2s;
        }

        body {
            padding: 0;
            margin: 0;
            -webkit-perspective: 1000;
            background-image: url(fondo.jpg);
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: calibri;
        }

        div {
            display: inline-block;
        }

        .area-tarjeta {
            cursor: pointer;
            width: var(--w);
            height: var(--h);
            perspective: 1000px;
        }

        .tarjeta {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .cara {
            position: absolute;
            backface-visibility: hidden;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 0 5px white;
            font-size: 500%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .trasera {
            background: linear-gradient(to right, #ff0000, #ffff00);
            transform: rotateY(180deg);
        }

        .superior {
            background: linear-gradient(to right, #ff0000, #ffff00);
        }

        .nuevo-juego {
            cursor: pointer;
            background: #ffffe0;
            padding: 20px;
            border-radius: 50px;
            border: 3px solid red;
            font-size: 130%;
            display: inline-block;
        }

        #puntos {
            display: inline-block;
            font-size: 300%;
            margin-left: 30px;
        }

        #temporizador {
            position: fixed;
            top: 500px;
            right: 20px;
            background-color: #ffffe0;
            border: 3px solid red;
            padding: 10px;
            border-radius: 10px;
            font-size: 150%;
            font-weight: bold;
            color: red;
        }

        #mensaje {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffe0;
            border: 3px solid red;
            padding: 20px;
            border-radius: 10px;
            font-size: 200%;
            font-weight: bold;
            color: red;
            text-align: center;
            z-index: 1000;
        }

        .informacion-adicional,
        .creditos,
        .referencia {
            margin-top: 20px;
            text-align: left;
            font-size: 120%;
            background-color: #ffffe0;
            border: 3px solid red;
            padding: 10px;
            border-radius: 10px;
            position: fixed;
        }

        .informacion-adicional {
            bottom: 20px;
            left: 20px;
        }

        .creditos {
            bottom: 120px;
            left: 20px;
        }

        .referencia {
            bottom: 70px;
            right: 20px;
        }

        .nombre-colegio {
            font-size: 300%;
            color: black;
            position: fixed;
            top: 20px;
            left: 20px;
        }

        /* Estilos para el botón de volumen */
        .volumen {
            position: fixed;
            bottom: 20px;
            left: 450px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .volumen-slider {
            display: none; /* Ocultar la barra de volumen por defecto */
            margin-left: 10px;
        }

        .volumen:hover .volumen-slider {
            display: block; /* Mostrar la barra de volumen al pasar el mouse */
        }

        @media (max-width: 600px) { /* Ajustes para pantallas pequeñas */
            :root {
                --w: calc(80vw / 4); /* Cambia el número de tarjetas que caben en una fila */
                --h: calc(80vw / 4); /* Ajustar el alto */
            }

            #temporizador {
                font-size: 100%; /* Ajustar el tamaño de la fuente */
            }

            #mensaje {
                font-size: 150%; /* Ajustar el tamaño de la fuente del mensaje */
            }

            .nuevo-juego {
                font-size: 100%; /* Ajustar el tamaño del botón */
            }

            #puntos {
                font-size: 150%; /* Ajustar el tamaño de los puntos */
            }
        }
    </style>
</head>

<body>

    <div id="tablero"></div>

    <br>

    <div>
        <div class="nuevo-juego" onclick="generarTablero()">
            Nuevo Juego
        </div>

        <div id="puntos">
            Puntos: 0
        </div>
    </div>

    <div id="temporizador">02:00</div>

    <div id="mensaje">
        <span id="resultado"></span><br>
        Aciertos: <span id="aciertos"></span><br>
        Errores: <span id="errores"></span><br>
        Porcentaje de Aciertos: <span id="porcentaje"></span>%<br>
        Tiempo gastado: <span id="tiempo"></span> segundos
        <button onclick="generarTablero()">Inicia otra vez</button>
    </div>

    <!-- Elemento de audio -->
    <audio id="musicaFondo" loop>
        <source src="Kevin MacLeod _ Scheming Weasel (faster version)(MP3_320K).mp3" type="audio/mp3">
        Tu navegador no soporta la reproducción de audio.
    </audio>

    <!-- Botón de volumen -->
    <div class="volumen" onmouseover="mostrarSlider()" onmouseout="ocultarSlider()">
        <i class="fas fa-volume-up" style="font-size: 40px;"></i>
        <input type="range" class="volumen-slider" min="0" max="1" step="0.01" value="0.5" onchange="ajustarVolumen(this.value)" />
    </div>

    <script>
        let puntos = 0;
        let errores = 0;
        let movimientos = 0;
        let iconos = [];
        let selecciones = [];
        let parejasVolteadas = [];
        let temporizador;
        let tiempoRestante = 120;
        let juegoActivo = false;

        // Función para iniciar la música de fondo
        function iniciarMusicaFondo() {
            const musica = document.getElementById("musicaFondo");
            musica.play();
        }

        // Función para ajustar el volumen
        function ajustarVolumen(volumen) {
            const musica = document.getElementById("musicaFondo");
            musica.volume = volumen; // Ajustar el volumen según el rango
        }

        function cargarIconos() {
            iconos = [
                '<i class="fas fa-star"></i>',
                '<i class="far fa-star"></i>',
                '<i class="fas fa-star-of-life"></i>',
                '<i class="fas fa-star-and-crescent"></i>',
                '<i class="fab fa-old-republic"></i>',
                '<i class="fab fa-galactic-republic"></i>',
                '<i class="fas fa-sun"></i>',
                '<i class="fas fa-stroopwafel"></i>',
                '<i class="fas fa-dice"></i>',
                '<i class="fas fa-chess-knight"></i>',
                '<i class="fas fa-chess"></i>',
                '<i class="fas fa-dice-d20"></i>',
            ];
        }

        function generarTablero() {
            clearInterval(temporizador); // Limpia cualquier temporizador previo.
            tiempoRestante = 120;
            document.getElementById("temporizador").innerText = "02:00";
            document.getElementById("mensaje").style.display = "none";

            puntos = 0;
            errores = 0;
            movimientos = 0;
            parejasVolteadas = [];
            document.getElementById("puntos").innerHTML = "Puntos: " + puntos;

            cargarIconos();
            selecciones = [];
            let tablero = document.getElementById("tablero");
            tablero.innerHTML = "";
            iconos = [...iconos, ...iconos];
            iconos.sort(() => Math.random() - 0.5); // Mezclar iconos.

            iconos.forEach((icono, index) => {
                let areaTarjeta = document.createElement("div");
                areaTarjeta.className = "area-tarjeta";
                areaTarjeta.setAttribute("data-id", index);
                areaTarjeta.onclick = seleccionarTarjeta;

                let tarjeta = document.createElement("div");
                tarjeta.className = "tarjeta";
                tarjeta.innerHTML = `<div class="cara superior">${icono}</div>
                                    <div class="cara trasera"></div>`;
                areaTarjeta.appendChild(tarjeta);
                tablero.appendChild(areaTarjeta);
            });

            juegoActivo = true; // Marca el juego como activo
            iniciarTemporizador();
            iniciarMusicaFondo(); // Iniciar la música de fondo
        }

        function seleccionarTarjeta() {
            if (!juegoActivo) return; // Si el juego no está activo, salir de la función.

            let tarjeta = this.querySelector(".tarjeta");
            let idTarjeta = this.getAttribute("data-id");

            if (selecciones.length < 2 && !selecciones.includes(idTarjeta) && !parejasVolteadas.includes(idTarjeta)) {
                tarjeta.style.transform = "rotateY(180deg)";
                selecciones.push(idTarjeta);

                if (selecciones.length === 2) {
                    movimientos++;
                    setTimeout(comprobarPareja, 1000);
                }
            }
        }

        function comprobarPareja() {
            let [primeraSeleccion, segundaSeleccion] = selecciones;
            let tarjetas = document.querySelectorAll(".tarjeta");

            if (tarjetas[primeraSeleccion].innerHTML === tarjetas[segundaSeleccion].innerHTML) {
                parejasVolteadas.push(primeraSeleccion, segundaSeleccion);
                puntos += 10;
                document.getElementById("puntos").innerHTML = "Puntos: " + puntos;
            } else {
                tarjetas[primeraSeleccion].style.transform = "rotateY(0deg)";
                tarjetas[segundaSeleccion].style.transform = "rotateY(0deg)";
                errores++;
            }

            selecciones = [];

            if (parejasVolteadas.length === iconos.length) {
                terminarJuego();
            }
        }

        function iniciarTemporizador() {
            temporizador = setInterval(() => {
                tiempoRestante--;
                document.getElementById("temporizador").innerText = new Date(tiempoRestante * 1000).toISOString().substr(14, 5);

                if (tiempoRestante <= 0) {
                    clearInterval(temporizador);
                    terminarJuego();
                }
            }, 1000);
        }

        function terminarJuego() {
            juegoActivo = false; // Marca el juego como no activo
            clearInterval(temporizador);

            document.getElementById("resultado").innerText = "Juego Terminado";
            document.getElementById("aciertos").innerText = puntos / 10;
            document.getElementById("errores").innerText = errores;
            document.getElementById("porcentaje").innerText = ((puntos / (movimientos * 10)) * 100).toFixed(2);
            document.getElementById("tiempo").innerText = 120 - tiempoRestante;
            document.getElementById("mensaje").style.display = "block"; // Muestra el mensaje
        }

        function mostrarSlider() {
            document.querySelector('.volumen-slider').style.display = 'block'; // Mostrar slider
        }

        function ocultarSlider() {
            document.querySelector('.volumen-slider').style.display = 'none'; // Ocultar slider
        }
    </script>
</body>

</html>
